services:
  app:
    build: .
    ports:
      - "3456:3456"
    volumes:
      - ./data:/data
      - ${HOME}/.claude:/root/.claude
      - ${PROJECTS_DIR:-.}:/projects
    env_file: .env
    restart: unless-stopped
    networks:
      - internal

  caddy:
    image: caddy:2-alpine
    ports:
      - "443:443"
      - "80:80"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
    environment:
      - DAEMON_DOMAIN=${DAEMON_DOMAIN:-localhost}
    restart: unless-stopped
    networks:
      - internal

  # Optional: Tailscale sidecar for remote access from anywhere
  # Uncomment this service and set TS_AUTHKEY in .env to enable
  # tailscale:
  #   image: tailscale/tailscale:latest
  #   hostname: claude-daemon
  #   environment:
  #     - TS_AUTHKEY=${TS_AUTHKEY}
  #     - TS_STATE_DIR=/var/lib/tailscale
  #     - TS_USERSPACE=true
  #     - TS_SERVE_CONFIG=/config/serve.json
  #   volumes:
  #     - tailscale_state:/var/lib/tailscale
  #     - ./tailscale-serve.json:/config/serve.json:ro
  #   restart: unless-stopped
  #   networks:
  #     - internal

volumes:
  caddy_data:
  caddy_config:
  # tailscale_state:

networks:
  internal:
